import 'dart:io';
import 'dart:convert';

void main() {
  print('üîÑ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è asset-—Ñ–∞–π–ª–æ–≤...');

  // –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É generated –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
  final generatedDir = Directory('lib/generated');
  if (!generatedDir.existsSync()) {
    generatedDir.createSync(recursive: true);
  }

  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º auth_assets.dart
  _generateAuthAssets();

  // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã
  // _generateProductAssets();

  print('‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
}

void _generateAuthAssets() {
  final authDir = Directory('assets/images/auth');

  if (!authDir.existsSync()) {
    print('‚ö†Ô∏è –ü–∞–ø–∫–∞ assets/images/auth –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, —Å–æ–∑–¥–∞–µ–º –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª');
    _writeAuthAssetsFile([]);
    return;
  }

  // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ webp —Ñ–∞–π–ª—ã, –∫—Ä–æ–º–µ logo
  final backgroundFiles = authDir
      .listSync()
      .where((file) =>
          file is File &&
          file.path.endsWith('.webp') &&
          !file.path.contains('logo'))
      .map((file) => 'assets/images/auth/${file.path.split('/').last}')
      .toList();

  // –°–æ—Ä—Ç–∏—Ä—É–µ–º –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
  backgroundFiles.sort();

  print('üì∏ –ù–∞–π–¥–µ–Ω–æ —Ñ–æ–Ω–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: ${backgroundFiles.length}');
  _writeAuthAssetsFile(backgroundFiles);
}

void _writeAuthAssetsFile(List<String> backgrounds) {
  final code = '''
// GENERATED CODE - DO NOT MODIFY BY HAND
// Generated by tool/generate_assets.dart

class AuthAssets {
  /// –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ–æ–Ω–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è —ç–∫—Ä–∞–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  static const List<String> backgrounds = ${jsonEncode(backgrounds)};
  
  /// –õ–æ–≥–æ—Ç–∏–ø –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  static const String logo = 'assets/images/auth/logo.webp';
  
  /// –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ª–æ–≥–æ—Ç–∏–ø –≤ assets
  static bool get hasLogo => true; // –õ–æ–≥–æ—Ç–∏–ø –≤—Å–µ–≥–¥–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å
  
  /// –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–æ–Ω–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  static int get backgroundCount => backgrounds.length;
  
  /// –ü–æ–ª—É—á–∏—Ç—å —Ñ–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ –∏–Ω–¥–µ–∫—Å—É (—Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –≤—ã—Ö–æ–¥–∞ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã)
  static String getBackground(int index) {
    if (backgrounds.isEmpty) return '';
    return backgrounds[index % backgrounds.length];
  }
}
''';

  File('lib/generated/auth_assets.dart').writeAsStringSync(code);
  print('üìÑ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω lib/generated/auth_assets.dart');
}
